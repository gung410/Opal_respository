<div class="flex home-module">
  <kendo-grid class="opal-grid"
              #grid
              [data]="gridData"
              [rowClass]="rowCallback"
              [skip]="state.skip"
              [pageSize]="state.take"
              [pageable]="true"
              (pageChange)="onPageChange($event)"
              (cellClick)="onItemClick($event)">
    <kendo-grid-column class="description-col cursor-pointer"
                       [title]="'Title' | translator"
                       field="title"
                       [width]="395">
      <ng-template let-dataItem
                   kendoGridCellTemplate>
        <div class="form-repository-page__item-title">
          <ng-container>
            <img class="grid-file-type"
                 [src]="getIconUrl(dataItem.fileExtension)">
          </ng-container>
          <span title="{{dataItem.title}}">{{ dataItem.title }}</span>
        </div>
      </ng-template>
      <ng-template let-column="column"
                   let-dataItem="dataItem"
                   let-formGroup="formGroup"
                   let-isNew="isNew"
                   let-rowIndex="rowIndex"
                   kendoGridEditTemplate>
        <div [formGroup]="formGroup">
          <input class="k-textbox"
                 type="text"
                 kendoErrorTooltip
                 formControlName="title"
                 (focusout)="checkAndSaveInlineInput(dataItem, formGroup.get(column.field))"
                 (keydown)="onGridTitleInputKeydown($event, dataItem, formGroup.get(column.field))">
        </div>
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-column [field]="'owner'"
                       [title]="'Owner'">
      <!-- Cell template of owner field-->

      <ng-template kendoGridCellTemplate
                   let-dataItem>
        <span *ngIf="dataItem.owner">{{dataItem.owner.fullName}}</span>
        <em *ngIf="!dataItem.owner">{{ 'Unknown User' | translator}}</em>
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-column [field]="'type'"
                       [title]="'Type'">
      <ng-template let-dataItem
                   kendoGridCellTemplate>
        <span>{{getContentType(dataItem.fileExtension)}}</span>
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-column [field]="'changedDate'"
                       [title]="'Last Modified'"
                       [hidden]="isHidden('changedDate')">
      <ng-template kendoGridCellTemplate
                   let-dataItem>
        {{dataItem.changedDate | date: 'dd/MM/yyyy h:mm a'}}
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column class="description-col cursor-pointer"
                       [title]="'Archived By ' | translator"
                       field="archivedByUser"
                       [hidden]="isHidden('archivedByUser')">
      <ng-template let-dataItem
                   kendoGridCellTemplate>
        <span *ngIf="dataItem.archivedByUser">
          {{ (dataItem.archivedByUser?.fullName) | translator }}
        </span>
        <span *ngIf="!dataItem.archivedByUser">
          {{ 'System' | translator }}
        </span>
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-column class="description-col"
                       [title]="'Archived Date' | translator"
                       field="archiveDate"
                       [hidden]="isHidden('archiveDate')">
      <ng-template let-dataItem
                   kendoGridCellTemplate>
        {{ (dataItem.archiveDate) | relativeTimespan: 'dd/MM/yyyy h:mm a' }}
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column [field]="'status'"
                       [title]="'Status'">
      <!-- Cell template of status field-->
      <ng-template kendoGridCellTemplate
                   let-dataItem>
        <status-indicator [currentStatus]="dataItem.status"
                          [mapping]="digitalContentStatusMapping"></status-indicator>
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column class="description-col cursor-pointer"
                       [title]="'Download' | translator"
                       [field]="'isAllowDownload'">
      <ng-template let-dataItem
                   kendoGridCellTemplate>
        <span> {{ getAllowDownloadDisplay(dataItem.isAllowDownload)}} </span>
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column [field]="'expiresOn'"
                       [title]="'Expiry' | translator"
                       [hidden]="isHidden('expiresOn')">
      <ng-template kendoGridCellTemplate
                   let-dataItem>
        <b *ngIf="isExpired(dataItem.expiredDate); else elseCase">
          {{ 'Expired' |  globalTranslator }}
        </b>
        <ng-template #elseCase="">
          {{ dataItem.expiredDate | date: 'dd/MM/yyyy' }}
        </ng-template>
      </ng-template>
    </kendo-grid-column>

    <kendo-grid-column [field]="'actions'"
                       [class]="'grid-action'"
                       [title]="''"
                       [width]="80">
      <!-- Cell template of actions field-->
      <ng-template let-dataItem
                   let-rowIndex="rowIndex"
                   kendoGridCellTemplate>
        <img class="icon action"
             src="assets/images/icons/more.svg"
             [ngClass]="{'active': rowIndex===focusRow, 'd-none': getContextMenuByDigitalContent(dataItem).length === 0}"
             #more>
        <kendo-contextmenu [target]="more"
                           [alignToAnchor]="true"
                           [anchorAlign]="defaultContextMenuAnchorAlign"
                           [popupAlign]="defaultContextMenuPopupAlign"
                           [items]="getContextMenuByDigitalContent(dataItem)"
                           (select)="onSelectedContextMenu($event, dataItem, rowIndex)"
                           (popupClose)="onContextMenuChange(-1)"
                           (popupOpen)="onContextMenuChange(rowIndex)"
                           showOn="click">
        </kendo-contextmenu>
      </ng-template>
    </kendo-grid-column>
  </kendo-grid>
</div>
