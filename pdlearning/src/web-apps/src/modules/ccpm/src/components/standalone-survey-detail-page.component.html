<app-toolbar [mergeHeader]="true"
             [detailToolbar]="true">
  <toolbar-left>
    <detail-title [title]="formData.title"
                  [allowEditTitle]="canSaveForm"
                  [settings]="detailTitleSettings"
                  [maxLength]="MAX_LENGTH_TITLE"
                  (titleChange)="onTitleChange($event)"
                  (onBackButtonClick)="onBackButtonClick()"></detail-title>
  </toolbar-left>
  <toolbar-right [customContainerClass]="'standalone-survey-editor-page__toolbar-right-container'">
    <div class="standalone-survey-editor-page__btn-container">
      <status-indicator [mapping]="statusColorMap"
                        [currentStatus]="formData.status"></status-indicator>
      <ng-container *ngIf="isContentCreator">
        <button class="k-margin-left-10"
                kendoButton
                *ngIf="isOwner"
                [primary]="true"
                (click)="onTransferOwnershipBtnClicked()">
          {{'Transfer Ownership' | translator}}
        </button>
        <button class="k-margin-left-10"
                kendoButton
                *ngIf="canShowEditButton"
                [primary]="true"
                (click)="onEditButtonClick()">
          {{ 'Edit' | translator }}
        </button>
        <button class="standalone-survey-editor-page__save-btn"
                kendoButton
                [primary]="true"
                *ngIf="canSaveForm"
                (click)="onSaveBtnClicked(SurveyStatus.Draft, true)">{{'Save' | translator}}</button>
        <button class="standalone-survey-editor-page__save-btn"
                kendoButton
                [primary]="true"
                *ngIf="canShowDuplicateButton"
                (click)="onDuplicateBtnClicked()">{{'Duplicate' | translator}}</button>
        <button class="standalone-survey-editor-page__save-btn"
                kendoButton
                [primary]="true"
                *ngIf="canShowArchiveButton"
                (click)="onArchiveBtnClicked()">{{'Archive' | translator}}</button>
        <button class="standalone-survey-editor-page__save-btn"
                kendoButton
                *ngIf="canPublish && isContentCreator"
                [primary]="true"
                (click)="onPublishClicked()">{{'Publish' | translator}}</button>
        <button class="standalone-survey-editor-page__save-btn"
                kendoButton
                [primary]="true"
                *ngIf="canUnpublish && isContentCreator"
                (click)="onUnpublishClicked()">{{'Unpublish' | translator}}</button>
      </ng-container>

    </div>
  </toolbar-right>
</app-toolbar>

<div class="standalone-survey-detail-page">
  <kendo-tabstrip formTabs
                  (tabSelect)="onTabSelect($event)"
                  [animate]="
                  false"
                  *ngIf="!isWebPreview"
                  [keepTabContent]="true">
    <kendo-tabstrip-tab [selected]="true">
      <ng-template kendoTabTitle="">
        {{ 'Editor' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <standalone-survey-editor-page *ngIf="isFormDataLoaded && isFormQuestionsDataLoaded"
                                       [(formData)]="formData"
                                       [(formSectionsQuestions)]="formSectionsQuestions"
                                       (click)="onQuestionAreaClick()">
        </standalone-survey-editor-page>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Additional information' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <detail-content-fragment class="flex survey-detail-page f-detail-content-container"></detail-content-fragment>
        <standalone-survey-additional-information-tab [formData]="formData">
        </standalone-survey-additional-information-tab>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Audit Log' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <audit-log-tab (revertChange)="onRevertData($event)"
                       [activeObjectId]="formData.id"
                       [allowRevert]="formData.status !== SurveyStatus.Archived"
                       [originalObjectId]="formData.originalObjectId"
                       [versionTrackingType]="versionTrackingType">
        </audit-log-tab>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Access Right' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <access-right-tab [allowAddCollaborator]="isAllowAddCollaborator"
                          [allowDeleteCollaborator]="isOwner"
                          [originalObjectId]="formData.originalObjectId"
                          [itemTitle]="formData.title"
                          [accessRightType]="accessRightType"
                          [currentModule]="'LNA'">
        </access-right-tab>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Comments' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <comment-tab [input]="commentTabInput">
        </comment-tab>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Report broken link' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <broken-link-report-tab [originalObjectId]="formData.originalObjectId"
                                [module]="brokenLinkModule"
                                [loadOnInit]="true"></broken-link-report-tab>
      </ng-template>
    </kendo-tabstrip-tab>
    <kendo-tabstrip-tab>
      <ng-template kendoTabTitle="">
        {{ 'Participants' | translator }}
      </ng-template>
      <ng-template kendoTabContent="">
        <standalone-form [(formData)]="formData"
                         [formSectionsQuestions]="formSectionsQuestions"
                         [originalObjectId]="formData.originalObjectId"
                         [isFromLNASurveys]="true"
                         [formParticipantType]="formParticipantType"></standalone-form>
      </ng-template>
    </kendo-tabstrip-tab>
  </kendo-tabstrip>
  <kendo-dropdownbutton *ngIf="!isWebPreview"
                        [data]="previewOptions"
                        [popupSettings]="{ popupClass: 'ccpm-preview-button-modes' }"
                        [buttonClass]="'k-button-preview'">
    {{ 'Preview' | translator }}
  </kendo-dropdownbutton>

  <div class="column flex web-preview"
       *ngIf="previewMode === PreviewMode.Web || previewMode === PreviewMode.Mobile">
    <button class="k-button-close-preview"
            (click)="hideWebPreviewer()"><span class="k-icon k-i-arrow-chevron-left"></span><span>Close Preview</span></button>
    <standalone-survey-quiz-player-page [formQuestionsData]="this.removeUnsupportedQuestionTypes(formSectionsQuestions.formQuestions)"
                                        [isPreviewMode]="true"
                                        *ngIf="previewMode === PreviewMode.Web">
    </standalone-survey-quiz-player-page>
    <mobile-previewer *ngIf="previewMode === PreviewMode.Mobile">
      <ng-template mobilePreviewerContent="">
        <standalone-survey-quiz-player-page class="lecture-player__quiz-player"
                                            [formQuestionsData]="this.removeUnsupportedQuestionTypes(formSectionsQuestions.formQuestions)"
                                            [isPreviewMode]="true"></standalone-survey-quiz-player-page>
      </ng-template>
    </mobile-previewer>
  </div>
</div>
