---
format_version: 3
environments:
  systemtest:
    pipelines:
      - cx-course-api-snapshot-build
  development:
    pipelines:
      - cx-course-api-development
  uat-next:
    pipelines:
      - cx-course-api-uat-next
pipelines:
  cx-course-api-snapshot-build:
    group: cx-course-api-snapshot
    label_template: "snapshot-2.0.${COUNT}"
    lock_behavior: none
    parameters: # list of parameters that can be configured for a pipeline
      PROJECT_DIR: src/microservices/course-microservice/Api/
      SONAR_PROJECTKEY: cx-course-api-release
      SONAR_SOLUTION_FILE: PlatformWorkspace.sln
    environment_variables:
      DOCKER_IMAGE_TAG:
      DOCKER_IMAGE_REPO: cx-course-api
    template: osd-linux-docker-build-sonar-dotnetcore
    materials:
      bitbuket-git:
        branch: releases/2.0
        git: "https://bitbucket.org/cxdev/cx-opal20-platform.git"
        username: samnguyenn
        encrypted_password: AES:Gl+5mhjKWgWeGW5TCVLRlA==:xT2hvR8chS49PNkvuN2xhw==
        whitelist:
          - src/microservices/course-microservice/Api/**/*.*
  cx-course-api-development:
    group: cx-course-api-snapshot
    label_template: "${upstream}"
    materials:
      upstream:
        pipeline: cx-course-api-snapshot-build
        stage: docker-push
    parameters: # list of parameters that can be configured for a pipeline
      UP_STREAME_PIPELINE_NAME: cx-course-api-snapshot-build
      UP_STREAME_PIPELINE_STAGE: docker-push
      UP_STREAME_PIPELINE_JOB: docker-push
    environment_variables:
      DOCKER_IMAGE_TAG:
      DOCKER_IMAGE_REPO: cx-course-api
    template: ansible-deploy-fetch-upstream
  cx-course-api-uat-next:
    group: cx-course-api-snapshot
    label_template: "${upstream}"
    materials:
      upstream:
        pipeline: cx-course-api-snapshot-build
        stage: docker-push
    parameters: # list of parameters that can be configured for a pipeline
      UP_STREAME_PIPELINE_NAME: cx-course-api-snapshot-build
      UP_STREAME_PIPELINE_STAGE: docker-push
      UP_STREAME_PIPELINE_JOB: docker-push
    environment_variables:
      DOCKER_IMAGE_TAG:
      DOCKER_IMAGE_REPO: cx-course-api
    template: ansible-deploy-fetch-upstream
